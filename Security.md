# セキュリティ

1.  リリースビルドではログが無効になるようにする

    `BuildConfig.DEBUG` を利用して、リリースビルドではログ出力が無効になるようにする。

    理由:

    * ログはLogCatによって誰でも閲覧可能であり、悪意のあるユーザに
      システム内部の構造等の情報を与えてしまうリスクがあるため。

    例:

    ```java
    public final class LogUtils {
        public static final i(String tag, String msg) {
            if (BuildConfig.DEBUG) {
                Log.i(tag, msg);
            }
        }
    }
    ```

1.  ログに重要な情報を含めない

    リリースビルドでログ出力が必要な場合であっても、重要な情報を含めてはならない。

1.  Intentに重要な情報を含めない

    `Intent`の内容はログ出力される。  
    また、暗黙的Intentでは共有先のIntentがそれらの情報をどのように利用するか分からない。  
    単純な画面間のデータ連携が目的であれば、重要な情報を含めず、明示的Intentを使う。  
    また、データ受け渡しの手段として、`Application`クラスを活用したりデータベースに保存することも検討する。

1.  難読化する

    APKファイルは単なるZIPファイルであり、その中のdexファイルはツールで
    簡単にjarファイルに変換できる。さらに、jarファイル内のクラスファイルは
    逆コンパイルしてJavaソースコードとして表示できる。
    こうしてソースコード生成されても解読されにくいように、
    Androidが標準でサポートするProGuardを有効にする。

1.  JNIは難読化しない

    JNIではメソッドのシグニチャを使ってアクセスするため、
    JNIの関数に使うnativeメソッド、およびそのメソッドを持つクラスは
    難読化の対象外にしなければならない。  
    同様に、C/C++からアクセスするJavaクラスも
    難読化の対象外にしなければならない。

1.  機密情報を散乱させない

    パスワード、キー情報等の重要情報は可能であればJavaコード部分に記述しない。  
    やむを得ず記述する場合でも、XMLのstringで定義するよりは
    Javaコードで書いた方がよい。

    理由:

    * XMLはツールにより完全にリバース生成できてしまうが、
      Javaコードは難読化によってリバース生成されても意味を
      把握しにくくすることはできる。

1.  不要なIntent-Filterを定義しない

    意図せず悪用されることを避けるため、必要のない汎用的なIntent-Filterを
    定義しないこと。  
    例えば、`Intent.ACTION_VIEW`, `Intent.ACTION_SEND`といったアクションの
    フィルタを定義すると、共有の操作で様々なアプリからデータを送られることになる。

1.  SDカードへのインストールを許容しない

    通常、APKファイルはアクセスできない領域へインストールされるが
    SDカードへインストールするとroot権限がなくてもアクセスできてしまう。

    注意:

    * 内部ストレージ容量が少ない端末を考慮する場合、
      アプリケーションのサイズによってはSDカードへインストールできないことが
      ユーザの不満に繋がる場合がある。

1.  不用意にWebViewのJavaScriptと連携しない

    WebViewではJavaScriptコードを通じて、ページとJavaコードを連携させることができるが、
    内容によってはアプリの挙動を外部サイトにコントロールされてしまう
    リスクがあることに留意する。

1.  ストレージのアクセス権はMODE_PRIVATEとする

    SQLiteや`SharedPreferences`を利用する場合、ファイルシステム上の実体のファイルの
    アクセス権は、外部アプリからアクセスできないモードになるようにする。

1.  assetsフォルダ、resフォルダに機密情報を置かない

    `assets`フォルダ、`res`フォルダには様々な種類のファイルを置くことができるが、
    他のアプリケーションからも容易に参照できる。  
    (アプリのパッケージさえ分かれば、`PackageManager`を使ってアクセスすることができる。)  
    これらの場所に配置するものには「外から見えない」ことを期待しないこと。  
    外から見えないようにするにはサーバにアクセスして取得するか、
    JNIを使ってC/C++プログラム内で情報を組み立てて取得する、などの工夫が必要。

1.  SQL文中のパラメータを自分で処理しない

    SQLiteで実行するSQL文を実行する際、ユーザ入力のパラメータを直接埋め込むと
    SQLインジェクション等の脆弱性となるため、`SQLiteDatabase#query()`や
    `SQLiteDatabase#compileStatement()`・`Statement#bindString()`等を用いて
    入力値のサニタイジング等を行なってSQLを実行すること。
